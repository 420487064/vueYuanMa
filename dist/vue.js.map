{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/obeserve/array.js","../src/obeserve/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\nconst attribut1 = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n\r\nconst startTagClose = /^\\s*(\\/?)>/; \r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n\r\nfunction parseHTML(html) {\r\n\r\n    //  console.log(html.match(attribut1));\r\n\r\n    function advance(n) {\r\n        html = html.substring(n);\r\n    }\r\n    function parseStartTag() {\r\n        const start = html.match(startTagOpen);\r\n        // console.log(start);\r\n        if (start) {\r\n            const match = {\r\n                tagName: start[1], // 标签名\r\n                attrs: [] \r\n            }\r\n            advance(start[0].length)\r\n        \r\n            // 如果不是开始标签就一直匹配下去\r\n            let attr,end;\r\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                advance(attr[0].length)\r\n                console.log(\"attr\",attr);\r\n                match.attrs.push({name:attr[1],value:attr[3] || attr[4] || attr[5] || true})\r\n                \r\n            }\r\n\r\n            if (end) {\r\n                advance(end[0].length)\r\n            }\r\n\r\n            // console.log(\"endhtml\",html);\r\n            \r\n        }\r\n\r\n        return false;\r\n    }\r\n    while (html) {\r\n        let textEnd = html.indexOf('<');\r\n        if(textEnd == 0){\r\n            const startTagMatch = parseStartTag();\r\n            if (startTagMatch) {\r\n                continue\r\n            }\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function compilerToFunction(template) {\r\n    let ast = parseHTML(template);\r\n    console.log(\"template\",ast);\r\n}","let oldArrayProto =  Array.prototype\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',  \r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    newArrayProto[method] = function(...args) {\r\n        const result = oldArrayProto[method].call(this,...args)\r\n        \r\n        let inserted;\r\n        let ob = this.__ob__;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;    \r\n                break;\r\n            case 'splice':\r\n                inserted = args.splice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (inserted) {\r\n            ob.observerArray(inserted);\r\n        }\r\n        return result;\r\n    }\r\n});","import { newArrayProto } from \"./array\";\r\n\r\nclass Observer{\r\n    constructor(data){\r\n        //  data.__ob__ = this; \r\n        Object.defineProperty(data,'__ob__',{\r\n            value: this,\r\n            enumerable: false\r\n        })\r\n        if(Array.isArray(data)){\r\n             data.__proto__ = newArrayProto;\r\n            this.obeserveArray(data);\r\n        }else{\r\n            this.walk(data);     \r\n        }\r\n    }\r\n    walk(data){\r\n        Object.keys(data).forEach(key => defineReactive(data,key,data[key]))\r\n    }\r\n    obeserveArray(data){\r\n        data.forEach(item => {\r\n            obeserve(item)\r\n        });\r\n    }\r\n}\r\n\r\nexport function defineReactive(target,key,value) {\r\n    obeserve(value);\r\n    Object.defineProperty(target,key,{\r\n        get(){\r\n            return value;\r\n        },\r\n        set(newvalue){\r\n            if(newvalue === value) return ;\r\n            value = newvalue;\r\n        }\r\n    })\r\n}\r\n\r\nexport function obeserve(data) {\r\n    if (typeof data !== 'object' || data == null) {\r\n        return;\r\n    }\r\n    \r\n    if (data.__ob__  instanceof Observer) {\r\n        return data.__ob__;\r\n    }\r\n    return new Observer(data);\r\n}","import { obeserve } from \"./obeserve/index.js\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    if (!opts.render) {\r\n        \r\n            initData(vm)     \r\n       \r\n    }\r\n}\r\n\r\nfunction proxy(vm,target,key) {\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[target][key];\r\n        },\r\n        set(newvalue){\r\n            if(vm[target][key] === newvalue) return;\r\n            vm[target][key] = newvalue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n\r\n    data = typeof data === 'function' ? data.call(vm) : data;\r\n    \r\n    vm._data = data\r\n\r\n    // 数据劫持\r\n    obeserve(data)\r\n    \r\n    for(let key in data){\r\n        proxy(vm,\"_data\",key);\r\n    }\r\n}","import { compilerToFunction } from \"./compiler/index.js\";\r\nimport { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {    \r\n    Vue.prototype._init = function(options) {\r\n        const vm = this\r\n        vm.$options = options \r\n\r\n        initState(vm);\r\n\r\n        if (options.el) {\r\n            vm.$mount(options.el)\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function(el){\r\n        const vm = this;\r\n        el = document.querySelector(el);\r\n        let ops = vm.$options;\r\n        if (!ops.render) {\r\n            let template;\r\n            if (!ops.template && el) {\r\n                template = el.outerHTML;\r\n            } else {\r\n                if (el) {\r\n                    template = ops.template;\r\n                }\r\n            }\r\n\r\n            if(template){\r\n                const render = compilerToFunction(template);\r\n                ops.render = render;\r\n            }\r\n            console.log(\"template\",template);\r\n        }\r\n\r\n        ops.render;\r\n    }\r\n}","import { initMixin } from \"./init.js\"\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["ncname","qnameCapture","startTagOpen","RegExp","attribute","startTagClose","parseHTML","html","advance","n","substring","parseStartTag","start","match","tagName","attrs","length","attr","end","console","log","push","name","value","textEnd","indexOf","compilerToFunction","template","ast","oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","splice","observerArray","Observer","constructor","data","defineProperty","enumerable","isArray","__proto__","obeserveArray","walk","keys","key","defineReactive","item","obeserve","target","get","set","newvalue","initState","vm","opts","$options","render","initData","proxy","_data","initMixin","Vue","_init","options","el","$mount","document","querySelector","ops","outerHTML"],"mappings":"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"}